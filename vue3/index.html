<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>关于vue3你需要知道的事 | happy coding</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="have fun with coding">
    
    <link rel="preload" href="/assets/css/0.styles.5b2ad578.css" as="style"><link rel="preload" href="/assets/js/app.94b461fa.js" as="script"><link rel="preload" href="/assets/js/2.5be9efca.js" as="script"><link rel="preload" href="/assets/js/14.025fb1ce.js" as="script"><link rel="prefetch" href="/assets/js/10.a4e8cb58.js"><link rel="prefetch" href="/assets/js/11.4fa810a3.js"><link rel="prefetch" href="/assets/js/12.7076bf3f.js"><link rel="prefetch" href="/assets/js/13.b142e5d4.js"><link rel="prefetch" href="/assets/js/15.188f7a0a.js"><link rel="prefetch" href="/assets/js/16.e21d937e.js"><link rel="prefetch" href="/assets/js/17.a33a86e2.js"><link rel="prefetch" href="/assets/js/18.5a3baa3a.js"><link rel="prefetch" href="/assets/js/19.ebb61865.js"><link rel="prefetch" href="/assets/js/20.f8e29efd.js"><link rel="prefetch" href="/assets/js/3.3fb33442.js"><link rel="prefetch" href="/assets/js/4.4827a1f8.js"><link rel="prefetch" href="/assets/js/5.1c54c189.js"><link rel="prefetch" href="/assets/js/6.15c0cadb.js"><link rel="prefetch" href="/assets/js/7.6900bd78.js"><link rel="prefetch" href="/assets/js/8.d888e939.js"><link rel="prefetch" href="/assets/js/9.74a365ea.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5b2ad578.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">happy coding</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="blog" class="dropdown-title"><span class="title">blog</span> <span class="arrow down"></span></button> <button type="button" aria-label="blog" class="mobile-dropdown-title"><span class="title">blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue3/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  最新
</a></li><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">
  about
</a></li></ul></div></div> <a href="https://github.com/GCGligoudan" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="blog" class="dropdown-title"><span class="title">blog</span> <span class="arrow down"></span></button> <button type="button" aria-label="blog" class="mobile-dropdown-title"><span class="title">blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue3/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  最新
</a></li><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">
  about
</a></li></ul></div></div> <a href="https://github.com/GCGligoudan" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/vue3/" aria-current="page" class="active sidebar-link">关于vue3你需要知道的事</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vue3/#_1-写在前面的话" class="sidebar-link">1. 写在前面的话</a></li><li class="sidebar-sub-header"><a href="/vue3/#_2-vue3-function-based-api-rfc" class="sidebar-link">2. Vue3 Function-based API RFC</a></li><li class="sidebar-sub-header"><a href="/vue3/#_3-vue3对比react-hooks" class="sidebar-link">3. vue3对比react hooks</a></li><li class="sidebar-sub-header"><a href="/vue3/#_4-新api所带来的心智负担" class="sidebar-link">4. 新api所带来的心智负担</a></li><li class="sidebar-sub-header"><a href="/vue3/#_5-vue3的新一代构建工具vite" class="sidebar-link">5. vue3的新一代构建工具vite</a></li><li class="sidebar-sub-header"><a href="/vue3/#_6-给计划使用vue3同学的一点建议" class="sidebar-link">6. 给计划使用vue3同学的一点建议</a></li></ul></li><li><a href="/vue_jsx/" class="sidebar-link">vue中的渲染函数/jsx和插槽slot</a></li><li><a href="/vue_jwt/" class="sidebar-link">vue-router结合vuex实现用户权限控制</a></li><li><a href="/leetcode/" class="sidebar-link">常见leetCode算法题目分享</a></li><li><a href="/vue_validate_mixin/" class="sidebar-link">使用vue中的mixin功能优化表单校验插件</a></li><li><a href="/vue_validate/" class="sidebar-link">使用vue自定义指令来开发一个表单验证插件</a></li><li><a href="/vue_test/" class="sidebar-link">vue单元测试vue test utils使用初探</a></li><li><a href="/node/" class="sidebar-link">初识nodejs</a></li><li><a href="/mxgraph/" class="sidebar-link">mxgraph入门解析</a></li><li><a href="/webpack4/" class="sidebar-link">webpack4配置入门和多文件打包</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="_1-写在前面的话"><a href="#_1-写在前面的话" class="header-anchor">#</a> 1. 写在前面的话</h2> <p>vue3在今年内应该就会推出，尤大之前也针对vue3的设计和api给出了<a href="https://zhuanlan.zhihu.com/p/68477600" target="_blank" rel="noopener noreferrer">RFC<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>和最新<a href="https://composition-api.vuejs.org/zh/" target="_blank" rel="noopener noreferrer">征求意见稿<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。本人阅读后总结了一些个人心得，希望对大家有用。</p> <h2 id="_2-vue3-function-based-api-rfc"><a href="#_2-vue3-function-based-api-rfc" class="header-anchor">#</a> 2. Vue3 Function-based API RFC</h2> <p>vue2在近几年不太长的生命周期内，经历了大小各种项目的历练，可以说非常易于上手，方便开发。同时也暴露了不少问题亟待解决：</p> <ol><li>组件之间难以逻辑组合与复用</li> <li>vue2缺少类型推导，即typescript支持</li> <li>打包尺寸较大，vue2打包时会将所有api的核心代码打包，不论其在开发中是否有用到</li> <li>definePropterty()实现的数据绑定无法实现数据对象新增属性值的变化，且vue中的数组方法也是自己polyfill实现的</li></ol> <p>vue3基于上述弊端重新设计了内部的实现方式，并且同时重新设计了组件选项和api。主要有：</p> <blockquote><p>重新设计了响应式数据对象，内部实现从defineProperty改为由浏览器原生支持的proxy实现。包括手动定义响应式数据（reactive）和包装对象（ref）两种api方式创建响应式数据。</p></blockquote> <ul><li>将数据变为响应式数据，可以追踪数据的变化，包括数组和对象的属性变化</li> <li>包装对象数据以变量的形式引用时（使用/修改）需要以a.value这种方式</li></ul> <p>示例代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// reactive响应式数据</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> reactive <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  state<span class="token punctuation">.</span>count <span class="token operator">++</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ref包装对象</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 以变量的形式引用包装对象</span>
<span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  count<span class="token punctuation">.</span>value <span class="token operator">++</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>新增了watchEffect api，和vue2中的watch效果类似，监测响应式数据变化并执行副作用函数。</p></blockquote> <ul><li>watchEffect将会在创建的时候立即执行一次，之后会在renderer flush即DOM更新后再执行回调函数，组件销毁时watch停止观察。</li> <li>watchEffect不需要将被依赖的数据源和副作用回调函数分开，只需写出副作用函数，即可自动将副作用中的所有响应式状态的 property 作为依赖进行追踪</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> reactive<span class="token punctuation">,</span> ref<span class="token punctuation">,</span> watchEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> titleCount <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 当state.count、titleCount变化时，watchEffect将会自动执行副作用回调函数</span>
<span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">count is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>state<span class="token punctuation">.</span>count<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
  document<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">title count is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>titleCount<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>重新设计了computed api，将会创建一个依赖其它状态的响应式状态。被依赖的状态可以是由reactive或ref创建响应式数据，生成的状态则是一个只读的包装对象，以变量的形式使用时需要以<code>.value</code>这种方式。</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> reactive<span class="token punctuation">,</span> ref<span class="token punctuation">,</span> computed <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> num <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> double <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>count <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment">// 使用ref创建响应式对象时需要用.value取值计算</span>
<span class="token keyword">const</span> triple <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> num<span class="token punctuation">.</span>value <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span>

<span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>double<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// -&gt; 0</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>triple<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token comment">// -&gt; 0</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

state<span class="token punctuation">.</span>count<span class="token operator">++</span> <span class="token comment">// -&gt; 2</span>
num<span class="token punctuation">.</span>value<span class="token operator">++</span> <span class="token comment">// -&gt; 3</span>
</code></pre></div><blockquote><p>新设计了setup()组件选项，代替之前的data组件选项。这个函数是组件开始逻辑的地方，它接收组件的props属性作为参数，然后开始调用，整个组件生命周期内只会执行一次。</p></blockquote> <ul><li>在setup中创建响应式数据对象，并return出去暴露给模板的上下文使用</li> <li>setup可以将函数方法返回出去，给模板使用</li> <li>setup接收的组件属性props本身也是个可追踪的响应式数据</li> <li>vue2中的生命周期经过重命名，只在setup中执行</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">const</span> MyComponent <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token function-variable function">appendName</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      msg<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>props<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      msg<span class="token punctuation">,</span>
      appendName
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div @click=&quot;appendName&quot;&gt;{{ msg }}&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>类型推导，需要使用defineComponent函数定义组件才能支持typescript类型推导</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">const</span> MyComponent <span class="token operator">=</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// props选项声明用来定义prop属性类型</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
    msg<span class="token operator">:</span> String
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>msg<span class="token punctuation">)</span> <span class="token comment">// string 或 undefined</span>

    <span class="token comment">// setup中返回的数据对象可以在模板中用于类型推断推断类型</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      count
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>在了解了上面的一些基本api后，我们可以看一下尤大给出的一个基本组件写法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> computed<span class="token punctuation">,</span> watchEffect<span class="token punctuation">,</span> onMounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">{</span>
  template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;div&gt;
      &lt;span&gt;count is {{ count }}&lt;/span&gt;
      &lt;span&gt;plusOne is {{ plusOne }}&lt;/span&gt;
      &lt;button @click=&quot;increment&quot;&gt;count++&lt;/button&gt;
    &lt;/div&gt;
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// reactive state</span>
    <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token comment">// computed state</span>
    <span class="token keyword">const</span> plusOne <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token comment">// method</span>
    <span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> count<span class="token punctuation">.</span>value<span class="token operator">++</span> <span class="token punctuation">}</span>
    <span class="token comment">// watch</span>
    <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> count<span class="token punctuation">.</span>value <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">count * 2 is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>val<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// lifecycle</span>
    <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">mounted</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// expose bindings on render context</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      count<span class="token punctuation">,</span>
      plusOne<span class="token punctuation">,</span>
      increment
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里只介绍了少数比较重要的vue3 api，而且不确定最终api还会不会再改动，如果想要详细查询学习的同学可以去查看官方<a href="https://composition-api.vuejs.org/zh/api" target="_blank" rel="noopener noreferrer">api文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h2 id="_3-vue3对比react-hooks"><a href="#_3-vue3对比react-hooks" class="header-anchor">#</a> 3. vue3对比react hooks</h2> <p>尤大亲自说过vue3的最新设计很大程度上是借鉴了react hooks的思路。具体相似的地方至少有：</p> <ol><li>定义数据的写法方式类似，react使用useState，vue3使用ref，创建响应式数据</li> <li>setup设计借鉴了react hooks，抽取函数和复用逻辑的方式类似，将逻辑和数据抽取成为独立的函数进行复用。</li></ol> <p>官方文档也给出了一个将获取鼠标位置的功能抽取成独立函数的实例：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 抽取获取鼠标x, y位置的成函数 mouse.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> onUnmounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useMousePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    x<span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>pageX
    y<span class="token punctuation">.</span>value <span class="token operator">=</span> e<span class="token punctuation">.</span>pageY
  <span class="token punctuation">}</span>

  <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> update<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> update<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useMousePosition <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./mouse'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMousePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 其他逻辑...</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果是写过react hooks的同学会发现，这与react hooks抽取公用函数的写法如出一辙。换句话说，写过两者其一的话，都有助于我们理解另一个框架。</p> <p>虽然vue3的写法类似于react hooks，但是其内部实现思路是不同的：</p> <ol><li>react hooks函数组件每次渲染的时候会重新执行一遍，而vue3的setup只会在组件初始化的时候执行一次。</li> <li>react hooks的useState创建组件状态值，处在一个独立的闭包空间内，每次使用的时候从这个独立空间重新获取值。而vue3的包装对象则是使用proxy将数据对象变成可追踪的响应式数据，这个思路跟vue2是一样的。</li></ol> <p>vue3的设计在尤大看来至少有一下优势：</p> <ol><li>整体上更符合 JavaScript 的直觉</li> <li>不受调用顺序的限制，可以有条件地被调用</li> <li>不会在后续更新时不断产生大量的内联函数而影响引擎优化或是导致 GC 压力</li> <li>不需要总是使用useCallback来缓存子组件的回调防止过度更新</li> <li>不需要关注useEffect/useMemo/useCallback的deps依赖数组是否正确的问题</li></ol> <h2 id="_4-新api所带来的心智负担"><a href="#_4-新api所带来的心智负担" class="header-anchor">#</a> 4. 新api所带来的心智负担</h2> <p>在阅读api设计文档时确实发现一些容易让开发者搞晕的东西，尤大对此也进行了总结。对于我个人来说有以下比较麻烦的地方：</p> <ol><li>使用ref创建的响应式数据难以区分什么时候需要使用.value方式访问</li> <li>难以区分什么时候该使用reactive，什么时候该用ref创建响应式数据</li> <li>写法不正确时，使用reactive创建的响应式数据有丢失响应式的可能</li> <li>对setup赋予的职责过大，且创建响应式数据和响应函数的逻辑十分灵活，几乎没有限制。会导致不同开发者写出来的代码可读性差距极大。</li></ol> <p>我个人希望vue3正式推出的时候，文档可能提供api使用推荐写法，同时能提供相应的lint校验插件辅助，这样才好让不同开发者写出通用可读的代码。</p> <h2 id="_5-vue3的新一代构建工具vite"><a href="#_5-vue3的新一代构建工具vite" class="header-anchor">#</a> 5. vue3的新一代构建工具vite</h2> <p>随着vue3而来的构建工具不是webpack，而是vite一种新型的项目构建工具。vite作用类似webpack，但是原理与webpack不同。对比webpack有以下优势：</p> <ol><li>快读冷启动</li> <li>瞬间热更新</li> <li>真正的按需编译</li></ol> <p>我也研究了一下vite的技术原理：</p> <ol><li>浏览器原生支持（ie除外）的ESM（script module）api，通过在script标签中添加type=&quot;module&quot;就可以在代码中使用export import语法，通过浏览器端直接导入、导出模块使用。</li> <li>ESM的原理是浏览器将import导入的模块转换成http请求加载对应的资源，需要什么模块就加载对应的模块。</li> <li>vite将开启一个本地的koa服务，劫持ESM中由import导入模块时的http请求，所以vite与webpack不同，不会对代码中所需要的模块进行静态分析并抽取成bundle。</li> <li>vite劫持后import导入的模块的http请求后，判断请求文件类型，对不同的模块文件使用不同的方法进行解析处理，如对vue文件，使用的就是vue的自带的模板解析/css解析/等功能，对css文件/ts文件等</li></ol> <h2 id="_6-给计划使用vue3同学的一点建议"><a href="#_6-给计划使用vue3同学的一点建议" class="header-anchor">#</a> 6. 给计划使用vue3同学的一点建议</h2> <ol><li>可以对比性的使用react hooks试试看，目前react hooks也相对比较成熟了。</li> <li>建议学习typescript，可以的项目可以使用typescript开发试试。</li></ol> <hr> <p>*作者简介： 宫晨光，<a href="http://www.genetalks.com/about-us.html" target="_blank" rel="noopener noreferrer">人和未来<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>大数据前端工程师。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/vue_jsx/">
        vue中的渲染函数/jsx和插槽slot
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.94b461fa.js" defer></script><script src="/assets/js/2.5be9efca.js" defer></script><script src="/assets/js/14.025fb1ce.js" defer></script>
  </body>
</html>
