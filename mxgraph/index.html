<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>mxgraph入门解析 | happy coding</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="have fun with coding">
    
    <link rel="preload" href="/assets/css/0.styles.5b2ad578.css" as="style"><link rel="preload" href="/assets/js/app.94b461fa.js" as="script"><link rel="preload" href="/assets/js/2.5be9efca.js" as="script"><link rel="preload" href="/assets/js/12.7076bf3f.js" as="script"><link rel="prefetch" href="/assets/js/10.a4e8cb58.js"><link rel="prefetch" href="/assets/js/11.4fa810a3.js"><link rel="prefetch" href="/assets/js/13.b142e5d4.js"><link rel="prefetch" href="/assets/js/14.025fb1ce.js"><link rel="prefetch" href="/assets/js/15.188f7a0a.js"><link rel="prefetch" href="/assets/js/16.e21d937e.js"><link rel="prefetch" href="/assets/js/17.a33a86e2.js"><link rel="prefetch" href="/assets/js/18.5a3baa3a.js"><link rel="prefetch" href="/assets/js/19.ebb61865.js"><link rel="prefetch" href="/assets/js/20.f8e29efd.js"><link rel="prefetch" href="/assets/js/3.3fb33442.js"><link rel="prefetch" href="/assets/js/4.4827a1f8.js"><link rel="prefetch" href="/assets/js/5.1c54c189.js"><link rel="prefetch" href="/assets/js/6.15c0cadb.js"><link rel="prefetch" href="/assets/js/7.6900bd78.js"><link rel="prefetch" href="/assets/js/8.d888e939.js"><link rel="prefetch" href="/assets/js/9.74a365ea.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5b2ad578.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">happy coding</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="blog" class="dropdown-title"><span class="title">blog</span> <span class="arrow down"></span></button> <button type="button" aria-label="blog" class="mobile-dropdown-title"><span class="title">blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue3/" class="nav-link">
  最新
</a></li><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">
  about
</a></li></ul></div></div> <a href="https://github.com/GCGligoudan" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="blog" class="dropdown-title"><span class="title">blog</span> <span class="arrow down"></span></button> <button type="button" aria-label="blog" class="mobile-dropdown-title"><span class="title">blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/vue3/" class="nav-link">
  最新
</a></li><li class="dropdown-item"><!----> <a href="/about/" class="nav-link">
  about
</a></li></ul></div></div> <a href="https://github.com/GCGligoudan" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/vue3/" class="sidebar-link">关于vue3你需要知道的事</a></li><li><a href="/vue_jsx/" class="sidebar-link">vue中的渲染函数/jsx和插槽slot</a></li><li><a href="/vue_jwt/" class="sidebar-link">vue-router结合vuex实现用户权限控制</a></li><li><a href="/leetcode/" class="sidebar-link">常见leetCode算法题目分享</a></li><li><a href="/vue_validate_mixin/" class="sidebar-link">使用vue中的mixin功能优化表单校验插件</a></li><li><a href="/vue_validate/" class="sidebar-link">使用vue自定义指令来开发一个表单验证插件</a></li><li><a href="/vue_test/" class="sidebar-link">vue单元测试vue test utils使用初探</a></li><li><a href="/node/" class="sidebar-link">初识nodejs</a></li><li><a href="/mxgraph/" aria-current="page" class="active sidebar-link">mxgraph入门解析</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/webpack4/" class="sidebar-link">webpack4配置入门和多文件打包</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h3> <p>公司今年有个需求是希望前端能展现出大数据计算过程的拓扑图，最好还是能够动态展现。部门老大给我们推荐了mxgraph这个绘图js库，希望我们能够熟练掌握。于是我就先着手开始研究起来了。不过我现在对于mxgraph的掌握还非常的渣，这篇文章是记录到现在为止我的学习成果。
</p> <h3 id="关于js绘图"><a href="#关于js绘图" class="header-anchor">#</a> 关于js绘图</h3> <p>绘图这块是前端的一个细分领域，是属于那种做的人不多，但深入下去很有前景的一个方向，当然也是一个比较难的方向。提到js图库，大家一般都会想到的是echarts、3D.js或者three.js之类的。echarts是使用他们给定的图库，大多是图表，改变自己的数据或者是定制一些细节。3D.js和three.js了解不多，但是貌似是从点线开始画起的。如果用来开发，成本难度就稍微有点大。我们公司是希望能够根据自己的需求定制化图形，最好是有一些基础的图元，和封装好的api操作，所以老大给我们推荐了mxgraph。</p> <h3 id="关于mxgraph"><a href="#关于mxgraph" class="header-anchor">#</a> 关于mxgraph</h3> <p>mxgraph库是一个诞生比较久的项目，提供了基础的图元和绘制方法，封装了绘制过程中的基础操作api。有一些比较著名的在线绘图网站就是基于mxgraph二次开发的，比如<a href="https://www.draw.io/" target="_blank" rel="noopener noreferrer">draw.io<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、<a href="https://www.processon.com/" target="_blank" rel="noopener noreferrer">process on<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。<a href="https://github.com/jgraph/mxgraph" target="_blank" rel="noopener noreferrer">mxgraph库<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>在github上有三千多个star，提供了90多个demo给使用者阅读，demo展现了绝大多数mxgraph所能做到的事。最常见的上手方式就是查看所给的示例demo，对照着示例的效果，查询对应的api文档查询用法。下面我便通过介绍几个我学习的demo来说明mxgraph的用法。</p> <h5 id="_1-hello-world"><a href="#_1-hello-world" class="header-anchor">#</a> 1.<a href="https://jgraph.github.io/mxgraph/javascript/examples/helloworld.html" target="_blank" rel="noopener noreferrer">hello world<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h5> <p>helloworld.html顾名思义，就像所有的程序学习最开始时，学习如何输出“hello world”一样，这个示例是所有的demo中最基础的一个。介绍了是如何使用mxgraph，绘制两个矩形，并将其连接在一起。我们来看完整的示例代码:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Hello<span class="token punctuation">,</span> World<span class="token operator">!</span> example <span class="token keyword">for</span> mxGraph<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;text/javascript&quot;</span><span class="token operator">&gt;</span>
  mxBasePath <span class="token operator">=</span> <span class="token string">'../src'</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;text/javascript&quot;</span> src<span class="token operator">=</span><span class="token string">&quot;../src/js/mxClient.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;text/javascript&quot;</span><span class="token operator">&gt;</span>
  <span class="token keyword">function</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter">container</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mxClient<span class="token punctuation">.</span><span class="token function">isBrowserSupported</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      mxUtils<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'Browser is not supported!'</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> graph <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mxGraph</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">new</span> <span class="token class-name">mxRubberband</span><span class="token punctuation">(</span>graph<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> parent <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">getDefaultParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>       
      graph<span class="token punctuation">.</span><span class="token function">getModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">beginUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">try</span>
      <span class="token punctuation">{</span>
        <span class="token keyword">var</span> v1 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertVertex</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'Hello,'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> v2 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertVertex</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'World!'</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> e1 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertEdge</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        graph<span class="token punctuation">.</span><span class="token function">getModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body onload<span class="token operator">=</span><span class="token string">&quot;main(document.getElementById('graphContainer'))&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;graphContainer&quot;</span> style<span class="token operator">=</span><span class="token string">&quot;position:relative;overflow:hidden;width:321px;height:241px;background:url('editors/images/grid.gif');cursor:default;&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre></div><p>这个示例中我们看到，如果要使用mxgraph，需要定义路径常量mxBasePath等于mxgraph核心资源的路径'../../src'，然后还要引用mxClient.js文件，在这之后我们就可以使用mxgraph了。
其中我把绘制的核心代码单独拿出来：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 新建一个mxgraph中的graph示例，graph可以理解为我们绘制图形的实例对象</span>
<span class="token keyword">var</span> graph <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mxGraph</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//获取当前图层之上的父图层</span>
<span class="token keyword">var</span> parent <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">getDefaultParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
<span class="token comment">// 每次新增图形，或者更新图形的时候必须要调用这个方法</span>
graph<span class="token punctuation">.</span><span class="token function">getModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">beginUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span>
<span class="token punctuation">{</span>
  <span class="token comment">// 这条语句在图层中绘制出一个内容为'Hello'的矩形</span>
  <span class="token comment">// insertVertex()函数中依次传入的是父图层，当前图元的id，图元中的内容，定位x，定位y，宽w，高h，后面还可以添加参数为当前图源的样式，是否为相对位置</span>
  <span class="token keyword">var</span> v1 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertVertex</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'Hello,'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> v2 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertVertex</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'World!'</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 这条语句使用insertEdge，在图层中绘制出一个由v1指向v2的线。</span>
  <span class="token keyword">var</span> e1 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertEdge</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
  <span class="token comment">// 每次更新或者新增图形之后必须调用这个方法，所以这个方法需要在finally中执行</span>
  graph<span class="token punctuation">.</span><span class="token function">getModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="_2-stylesheet-html"><a href="#_2-stylesheet-html" class="header-anchor">#</a> 2.<a href="https://jgraph.github.io/mxgraph/javascript/examples/stylesheet.html" target="_blank" rel="noopener noreferrer">stylesheet.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h5> <p>这个例子告诉我们如何修改图形的样式。分为两种方式，修改全局样式和修改单独某个图元的样式。
先看全局修改样式的代码:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 修改矩形图元的默认样式</span>
<span class="token keyword">var</span> style <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
style<span class="token punctuation">[</span>mxConstants<span class="token punctuation">.</span><span class="token constant">STYLE_SHAPE</span><span class="token punctuation">]</span> <span class="token operator">=</span> mxConstants<span class="token punctuation">.</span><span class="token constant">SHAPE_RECTANGLE</span><span class="token punctuation">;</span>
style<span class="token punctuation">[</span>mxConstants<span class="token punctuation">.</span><span class="token constant">STYLE_PERIMETER</span><span class="token punctuation">]</span> <span class="token operator">=</span> mxPerimeter<span class="token punctuation">.</span>RectanglePerimeter<span class="token punctuation">;</span>
style<span class="token punctuation">[</span>mxConstants<span class="token punctuation">.</span><span class="token constant">STYLE_ROUNDED</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
style<span class="token punctuation">[</span>mxConstants<span class="token punctuation">.</span><span class="token constant">STYLE_FILLCOLOR</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'#EEEEEE'</span><span class="token punctuation">;</span>
style<span class="token punctuation">[</span>mxConstants<span class="token punctuation">.</span><span class="token constant">STYLE_FONTCOLOR</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'#774400'</span><span class="token punctuation">;</span>
style<span class="token punctuation">[</span>mxConstants<span class="token punctuation">.</span><span class="token constant">STYLE_ALIGN</span><span class="token punctuation">]</span> <span class="token operator">=</span> mxConstants<span class="token punctuation">.</span><span class="token constant">ALIGN_CENTER</span><span class="token punctuation">;</span>
style<span class="token punctuation">[</span>mxConstants<span class="token punctuation">.</span><span class="token constant">STYLE_FONTSIZE</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'12'</span><span class="token punctuation">;</span>
graph<span class="token punctuation">.</span><span class="token function">getStylesheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putDefaultVertexStyle</span><span class="token punctuation">(</span>style<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 修改连线的默认样式</span>
style <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
style<span class="token punctuation">[</span>mxConstants<span class="token punctuation">.</span><span class="token constant">STYLE_SHAPE</span><span class="token punctuation">]</span> <span class="token operator">=</span> mxConstants<span class="token punctuation">.</span><span class="token constant">SHAPE_CONNECTOR</span><span class="token punctuation">;</span>
style<span class="token punctuation">[</span>mxConstants<span class="token punctuation">.</span><span class="token constant">STYLE_STROKECOLOR</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'#6482B9'</span><span class="token punctuation">;</span>
style<span class="token punctuation">[</span>mxConstants<span class="token punctuation">.</span><span class="token constant">STYLE_VERTICAL_ALIGN</span><span class="token punctuation">]</span> <span class="token operator">=</span> mxConstants<span class="token punctuation">.</span><span class="token constant">ALIGN_MIDDLE</span><span class="token punctuation">;</span>
style<span class="token punctuation">[</span>mxConstants<span class="token punctuation">.</span><span class="token constant">STYLE_EDGE</span><span class="token punctuation">]</span> <span class="token operator">=</span> mxEdgeStyle<span class="token punctuation">.</span>ElbowConnector<span class="token punctuation">;</span>
style<span class="token punctuation">[</span>mxConstants<span class="token punctuation">.</span><span class="token constant">STYLE_FONTSIZE</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'10'</span><span class="token punctuation">;</span>
graph<span class="token punctuation">.</span><span class="token function">getStylesheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putDefaultEdgeStyle</span><span class="token punctuation">(</span>style<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>mxStylesheet类用于管理图形样式，通过 graph.getStylesheet() 可以获取当前图形的 mxStylesheet对象。mxStylesheet 对象的 style 属性也是一个对象，该对象默认情况下包含两个对象defaultVertexStyle、defaultEdgeStyle，修改这两个对象里的样式属性对所有线条/节点都生效。</p> <p>我们看下如何单独修改某一个图元的样式。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> myStyle <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 定义一个自定义样式</span>
style<span class="token punctuation">[</span>mxConstants<span class="token punctuation">.</span><span class="token constant">STYLE_SHAPE</span><span class="token punctuation">]</span> <span class="token operator">=</span> mxConstants<span class="token punctuation">.</span><span class="token constant">SHAPE_RECTANGLE</span><span class="token punctuation">;</span>
style<span class="token punctuation">[</span>mxConstants<span class="token punctuation">.</span><span class="token constant">STYLE_STROKECOLOR</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'#6482B9'</span><span class="token punctuation">;</span>
style<span class="token punctuation">[</span>mxConstants<span class="token punctuation">.</span><span class="token constant">STYLE_ALIGN</span><span class="token punctuation">]</span> <span class="token operator">=</span> mxConstants<span class="token punctuation">.</span><span class="token constant">ALIGN_CENTER</span><span class="token punctuation">;</span>
style<span class="token punctuation">[</span>mxConstants<span class="token punctuation">.</span><span class="token constant">STYLE_VERTICAL_ALIGN</span><span class="token punctuation">]</span> <span class="token operator">=</span> mxConstants<span class="token punctuation">.</span><span class="token constant">ALIGN_MIDDLE</span><span class="token punctuation">;</span>
style<span class="token punctuation">[</span>mxConstants<span class="token punctuation">.</span><span class="token constant">STYLE_FONTSIZE</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'10'</span><span class="token punctuation">;</span>
 
<span class="token comment">// 这里我们使用putCellStyle() 定义一个自己的样式myCellStyle</span>
graph<span class="token punctuation">.</span><span class="token function">getStylesheet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putCellStyle</span><span class="token punctuation">(</span><span class="token string">'myCellStyle'</span><span class="token punctuation">,</span> myStyle<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 注意下面我们用了两种方式添加给一个单独的cell添加样式</span>
<span class="token keyword">var</span> v1 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertVertex</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'myCell'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token string">'myCellStyle;FONTCOLOR=#999999'</span><span class="token punctuation">)</span>
</code></pre></div><p>如上面所示，我们可以使用putCellStyle()自己定义个自己的样式对象，在新建图元的时候当作参数使用，也可以同时直接添加你想要的样式。格式如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token string">'stylename;key=value;'</span>
</code></pre></div><p>分号前可以跟命名样式名称或者一个样式的 key、value 。对了，如果使用 [mxConstants.STYLE_IMAGE]: 'path/image.png'这个样式属性的话，可以在节点上添加图片。</p> <h5 id="_3-wrapping-html"><a href="#_3-wrapping-html" class="header-anchor">#</a> 3.<a href="https://jgraph.github.io/mxgraph/javascript/examples/wrapping.html" target="_blank" rel="noopener noreferrer">wrapping.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h5> <p>这个例子告诉我们如何在节点(vertex)和连线(edge)的标签上使用HTML标签和字符换行，直接来看其中最核心的代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> graph <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mxGraph</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 渲染的时候使用html标签</span>
graph<span class="token punctuation">.</span><span class="token function">setHtmlLabels</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 在渲染线edge的时候 禁止使用页面内编辑</span>
graph<span class="token punctuation">.</span><span class="token function-variable function">isCellEditable</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cell</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">isEdge</span><span class="token punctuation">(</span>cell<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> parent <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">getDefaultParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

graph<span class="token punctuation">.</span><span class="token function">getModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">beginUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> v1 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertVertex</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'Cum Caesar vidisset, portum plenum esse, iuxta navigavit.'</span><span class="token punctuation">,</span>
      <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token string">'whiteSpace=wrap;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> v2 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertVertex</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'Cum Caesar vidisset, portum plenum esse, iuxta navigavit.'</span><span class="token punctuation">,</span>
      <span class="token number">220</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">70</span><span class="token punctuation">,</span> <span class="token string">'whiteSpace=wrap;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> e1 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertEdge</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'Cum Caesar vidisset, portum plenum esse, iuxta navigavit.'</span><span class="token punctuation">,</span>
      v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> <span class="token string">'whiteSpace=wrap;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  e1<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
  graph<span class="token punctuation">.</span><span class="token function">getModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>所以中核心的一代码为graph.setHtmlLabels(true)，同时配合节点的样式'whiteSpace=wrap'就可以实现在图中换行。</p> <h5 id="_4-htmllabel-html"><a href="#_4-htmllabel-html" class="header-anchor">#</a> 4.<a href="https://jgraph.github.io/mxgraph/javascript/examples/htmllabel.html" target="_blank" rel="noopener noreferrer">htmlLabel.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h5> <p>这个例子在节点(vertex)中添加了html代码，并用html关联了里面的状态：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> graph <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mxGraph</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>

graph<span class="token punctuation">.</span><span class="token function">setHtmlLabels</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个保存状态的xml用户对象</span>
<span class="token keyword">var</span> doc <span class="token operator">=</span> mxUtils<span class="token punctuation">.</span><span class="token function">createXmlDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'UserObject'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'label'</span><span class="token punctuation">,</span> <span class="token string">'Hello, World!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'checked'</span><span class="token punctuation">,</span> <span class="token string">'false'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Adds optional caching for the HTML label</span>
<span class="token keyword">var</span> cached <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>cached<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// Ignores cached label in codec</span>
  mxCodecRegistry<span class="token punctuation">.</span><span class="token function">getCodec</span><span class="token punctuation">(</span>mxCell<span class="token punctuation">)</span><span class="token punctuation">.</span>exclude<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Invalidates cached labels</span>
  graph<span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function-variable function">setValue</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cell<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    cell<span class="token punctuation">.</span>div <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    mxGraphModel<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 这里是重写了展示cell内部展现方法，改写为展示html标签的内容</span>
<span class="token comment">// 这里的代码可以实现自定义cell内部的html结构</span>
graph<span class="token punctuation">.</span><span class="token function-variable function">convertValueToString</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cell</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cached <span class="token operator">&amp;&amp;</span> cell<span class="token punctuation">.</span>div <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 使用缓存中的html</span>
    <span class="token keyword">return</span> cell<span class="token punctuation">.</span>div<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>mxUtils<span class="token punctuation">.</span><span class="token function">isNode</span><span class="token punctuation">(</span>cell<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> cell<span class="token punctuation">.</span>value<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'userobject'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 返回一个div标签的 dom元素</span>
    <span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    div<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> cell<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'label'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mxUtils<span class="token punctuation">.</span><span class="token function">br</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 添加一个换行</span>
    <span class="token comment">// 定义一个input checkbox元素</span>
    <span class="token keyword">var</span> checkbox <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    checkbox<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'type'</span><span class="token punctuation">,</span> <span class="token string">'checkbox'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置input的初始属性值</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cell<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'checked'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'true'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      checkbox<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'checked'</span><span class="token punctuation">,</span> <span class="token string">'checked'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      checkbox<span class="token punctuation">.</span>defaultChecked <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 添加checkbox被点击之后的事件处理</span>
    mxEvent<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>checkbox<span class="token punctuation">,</span> <span class="token punctuation">(</span>mxClient<span class="token punctuation">.</span><span class="token constant">IS_QUIRKS</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">'click'</span> <span class="token operator">:</span> <span class="token string">'change'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> elt <span class="token operator">=</span> cell<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      elt<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'checked'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>checkbox<span class="token punctuation">.</span>checked<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">'true'</span> <span class="token operator">:</span> <span class="token string">'false'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      graph<span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>cell<span class="token punctuation">,</span> elt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 在新建的div dom上添加input checkbox元素</span>
    div<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>checkbox<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>cached<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 将新建的html添加到缓存中</span>
      <span class="token comment">// Caches label</span>
      cell<span class="token punctuation">.</span>div <span class="token operator">=</span> div<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> div<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Overrides method to store a cell label in the model</span>
<span class="token keyword">var</span> cellLabelChanged <span class="token operator">=</span> graph<span class="token punctuation">.</span>cellLabelChanged<span class="token punctuation">;</span>
graph<span class="token punctuation">.</span><span class="token function-variable function">cellLabelChanged</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cell<span class="token punctuation">,</span> newValue<span class="token punctuation">,</span> autoSize</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>mxUtils<span class="token punctuation">.</span><span class="token function">isNode</span><span class="token punctuation">(</span>cell<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> cell<span class="token punctuation">.</span>value<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'userobject'</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token comment">// Clones the value for correct undo/redo</span>
    <span class="token keyword">var</span> elt <span class="token operator">=</span> cell<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    elt<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'label'</span><span class="token punctuation">,</span> newValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    newValue <span class="token operator">=</span> elt<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token function">cellLabelChanged</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Overrides method to create the editing value</span>
<span class="token keyword">var</span> getEditingValue <span class="token operator">=</span> graph<span class="token punctuation">.</span>getEditingValue<span class="token punctuation">;</span>
graph<span class="token punctuation">.</span><span class="token function-variable function">getEditingValue</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">cell</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>mxUtils<span class="token punctuation">.</span><span class="token function">isNode</span><span class="token punctuation">(</span>cell<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> cell<span class="token punctuation">.</span>value<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'userobject'</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">return</span> cell<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">'label'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> parent <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">getDefaultParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 使用自己定义xml用户对象 新建vertex</span>
graph<span class="token punctuation">.</span><span class="token function">insertVertex</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> obj<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上面这个代码包含了如何使用自己定义的html绘制节点(vertex)中的内容，且给其中的元素绑定事件。通过代码可以看出是需要同时新建一个xml对象和相应的dom元素。由此可以知道在mxgraph中每个图形都有其对应的xml数据结构。</p> <p>但是上述中的代码还有几处我也没搞懂的地方，比如缓存处理、cellLabelChanged()和getEditingValue()的用法，之后还需要查阅资料，或者请教公司的小伙伴。</p> <h5 id="_5-hierarchicallayout-html"><a href="#_5-hierarchicallayout-html" class="header-anchor">#</a> 5.<a href="https://jgraph.github.io/mxgraph/javascript/examples/hierarchicallayout.html" target="_blank" rel="noopener noreferrer">hierarchicallayout.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h5> <p>这个示例是展示了绘图中的两种自动布局方法，分别是分级和有机布局算法。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> graph <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mxGraph</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 在graph实例上新建这两种布局方法</span>
<span class="token keyword">var</span> layout <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mxHierarchicalLayout</span><span class="token punctuation">(</span>graph<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 分级布局</span>
<span class="token keyword">var</span> organic <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mxFastOrganicLayout</span><span class="token punctuation">(</span>graph<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 有机布局</span>
organic<span class="token punctuation">.</span>forceConstant <span class="token operator">=</span> <span class="token number">120</span><span class="token punctuation">;</span> <span class="token comment">// 这个值是有机布局节点的平均间距。默认是50</span>

<span class="token keyword">var</span> parent <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">getDefaultParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 添加一个触发分级布局的按钮</span>
<span class="token keyword">var</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mxUtils<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>button<span class="token punctuation">,</span> <span class="token string">'Hierarchical'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mxEvent<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>button<span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  layout<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 添加一个触发有机算法布局的按钮</span>
<span class="token keyword">var</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mxUtils<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>button<span class="token punctuation">,</span> <span class="token string">'Organic'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mxEvent<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>button<span class="token punctuation">,</span> <span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  organic<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span><span class="token punctuation">;</span>

graph<span class="token punctuation">.</span><span class="token function">getModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">beginUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span>
<span class="token punctuation">{</span>
  <span class="token keyword">var</span> v1 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertVertex</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> v2 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertVertex</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> v3 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertVertex</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> v4 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertVertex</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> v5 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertVertex</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> v6 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertVertex</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'6'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> v7 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertVertex</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'7'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> v8 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertVertex</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'8'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> v9 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertVertex</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'9'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> e1 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertEdge</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> e2 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertEdge</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> e3 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertEdge</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> v3<span class="token punctuation">,</span> v4<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> e4 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertEdge</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v5<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> e5 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertEdge</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v6<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> e6 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertEdge</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> e7 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertEdge</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> v6<span class="token punctuation">,</span> v4<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> e8 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertEdge</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> v6<span class="token punctuation">,</span> v1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> e9 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertEdge</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> v6<span class="token punctuation">,</span> v7<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> e10 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertEdge</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> v7<span class="token punctuation">,</span> v8<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> e11 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertEdge</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> v7<span class="token punctuation">,</span> v9<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> e12 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertEdge</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> v7<span class="token punctuation">,</span> v6<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> e13 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertEdge</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> v7<span class="token punctuation">,</span> v5<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 添加完点线之后 默认使用分级布局</span>
  layout<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
  graph<span class="token punctuation">.</span><span class="token function">getModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">endUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>mxClient<span class="token punctuation">.</span><span class="token constant">IS_QUIRKS</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 样式的兼容处理</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>overflow <span class="token operator">=</span> <span class="token string">'hidden'</span><span class="token punctuation">;</span>
  <span class="token keyword">new</span> <span class="token class-name">mxDivResizer</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这个例子比较简单，看注释就可以理解了。同时mxgraph中还有其他的布局算法。</p> <h5 id="_6-layers-html"><a href="#_6-layers-html" class="header-anchor">#</a> 6.<a href="https://jgraph.github.io/mxgraph/javascript/examples/layers.html" target="_blank" rel="noopener noreferrer">layers.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h5> <p>这个例子是使用多图层来放置细胞（cell），在动态绘图的过程中，或许可以使用这个来实现动态添加新的图层。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 在所给的container中用model新建graph</span>
<span class="token comment">// 需要个root和两个layers</span>
<span class="token comment">// 通过var layer = model.add(root, new mxCell())可以新增layer</span>
<span class="token keyword">var</span> root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mxCell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> layer0 <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">mxCell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> layer1 <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">mxCell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> model <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mxGraphModel</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> graph <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mxGraph</span><span class="token punctuation">(</span>container<span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">;</span>
graph<span class="token punctuation">.</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> parent <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">getDefaultParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
model<span class="token punctuation">.</span><span class="token function">beginUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span><span class="token punctuation">{</span>
  <span class="token comment">// 分别在不同的图层中添加vertex和edge</span>
  <span class="token keyword">var</span> v1 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertVertex</span><span class="token punctuation">(</span>layer1<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'Hello,'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token string">'fillColor=#C0C0C0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> v2 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertVertex</span><span class="token punctuation">(</span>layer1<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'Hello,'</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token string">'fillColor=#C0C0C0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> v3 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertVertex</span><span class="token punctuation">(</span>layer0<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'World!'</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> e1 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertEdge</span><span class="token punctuation">(</span>layer1<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v3<span class="token punctuation">,</span> <span class="token string">'strokeColor=#0C0C0C'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  e1<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>points <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">mxPoint</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">165</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> e2 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertEdge</span><span class="token punctuation">(</span>layer0<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  e2<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>points <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">mxPoint</span><span class="token punctuation">(</span><span class="token number">240</span><span class="token punctuation">,</span> <span class="token number">165</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> e3 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertEdge</span><span class="token punctuation">(</span>layer0<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span>
      <span class="token string">'edgeStyle=topToBottomEdgeStyle'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  e3<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>points <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">mxPoint</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  
  <span class="token keyword">var</span> e4 <span class="token operator">=</span> graph<span class="token punctuation">.</span><span class="token function">insertEdge</span><span class="token punctuation">(</span>layer1<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v1<span class="token punctuation">,</span>
      <span class="token string">'strokeColor=#0C0C0C;edgeStyle=topToBottomEdgeStyle'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  e4<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>points <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">mxPoint</span><span class="token punctuation">(</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
  model<span class="token punctuation">.</span><span class="token function">endUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 新增layer 0 按钮，点击控制layer0的显示隐藏</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>mxUtils<span class="token punctuation">.</span><span class="token function">button</span><span class="token punctuation">(</span><span class="token string">'Layer 0'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  model<span class="token punctuation">.</span><span class="token function">setVisible</span><span class="token punctuation">(</span>layer0<span class="token punctuation">,</span> <span class="token operator">!</span>model<span class="token punctuation">.</span><span class="token function">isVisible</span><span class="token punctuation">(</span>layer0<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 同上</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>mxUtils<span class="token punctuation">.</span><span class="token function">button</span><span class="token punctuation">(</span><span class="token string">'Layer 1'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  model<span class="token punctuation">.</span><span class="token function">setVisible</span><span class="token punctuation">(</span>layer1<span class="token punctuation">,</span> <span class="token operator">!</span>model<span class="token punctuation">.</span><span class="token function">isVisible</span><span class="token punctuation">(</span>layer1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p>上面知识简单介绍了几个跟公司需求有关的demo，其中还有有一些问题没有解决。比如如何绑定节点中的鼠标事件，如何将json数据转换为一个图形等等。还需要之后的努力。通过这几个星期的学习，清楚的认识到自己的能力还有较大的提升，同时英文真的是工程师很重要的一个技能。同时感觉到自己的对于问题的解决方案，还是缺少直觉。后面还需要继续的全面提高自己。</p> <h1 id="参考文章"><a href="#参考文章" class="header-anchor">#</a> 参考文章</h1> <p><a href="https://github.com/jgraph/mxgraph" target="_blank" rel="noopener noreferrer">mxGraph<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://jgraph.github.io/mxgraph/docs/js-api/files/index-txt.html" target="_blank" rel="noopener noreferrer">mxGraph api specification<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/SunInfoFE/mxGraph_User_Manual_CN" target="_blank" rel="noopener noreferrer">mxGraph用户手册中文版<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://segmentfault.com/a/1190000018510996" target="_blank" rel="noopener noreferrer">mxGraph入门实例教程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <hr> <p><em>作者简介： 宫晨光，<a href="http://www.genetalks.com/about-us.html" target="_blank" rel="noopener noreferrer">人和未来<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>大数据前端工程师。</em></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/node/" class="prev">
        初识nodejs
      </a></span> <span class="next"><a href="/webpack4/">
        webpack4配置入门和多文件打包
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.94b461fa.js" defer></script><script src="/assets/js/2.5be9efca.js" defer></script><script src="/assets/js/12.7076bf3f.js" defer></script>
  </body>
</html>
